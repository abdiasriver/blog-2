# 自定义元素

> _pengzhanbo | 2018-03-22_
____

在web应用开发中，HTML标签为我们提供了基础的应用结构和交互，我们使用HTML标签构建了丰富的web应用。但是，我们在开发web应用的过程中，进行复杂的组件开发，很容易就会陷入 `div` 标签堆砌，逐渐丢失了HTML语义化的特性。

在HTML5标准中，虽然也增加了不少包括 `<header>`、`<section>`、`<article>`、`<nav>`、`<container>`、`<footer>` 等更加语义化的标签，但它们更多的，是为内容而添加的语义化标签，在实际的使用场景中，并不能完全满足我们的需求。那么，假如有一种方式，能够让我们创建我们自己的标签，可以随意的选择满足我们使用场景的标签会是怎样？甚至可以扩展已有标签的特性会是怎样？ 

__自定义元素（custom Elements）__ 能够帮助我们做到这些！

### 什么是自定义元素

> 自定义元素能够帮助web开发者创建拥有自身特性的自定义标签。

### 创建自定义元素

使用`document.registerElement()` 创建自定义元素
``` javascript
var MyTag = document.registerElement('my-tag');
```
现在，你就可以在文档的任何位置使用你的标签了
``` html
<my-tag></my-tag>
```
我们也可以使用命令式创建自定义元素
``` javascript
var MyTag = document.registerElement('my-tag');
document.body.appendChild(new MyTag());
```
或者
``` javascript
var MyTag = document.registerElement('my-tag');
var myTag = document.createElement('my-tag');
document.body.appendChild(myTag);
```

__自定义元素命名规则__

名称必须包含至少一个 “-”,任何不含“-”的自定义标签都会导致错误。例如，`my-tag`，`my-list-item` 为合法标签，`my_tag`、`myTag` 都是非法的自定义标签名称。

### 添加自定义元素特性
`document.registerElement()` 的第二个参数允许我们为自定义元素添加新的特性。

在说明如何添加新的特性之前，需要先了解 `HTMLElement` 。

`HTMLElement` 对象表示HTML中的一个元素，继承了`Node`和`Element`对象的标准属性。 可前往 [HTMLElement](http://www.w3school.com.cn/xmldom/dom_htmlelement.asp) 了解。

我们通过 `HTMLElement.prototype` 调用 `Object.create()` 创建一个基本的原型，该原型上已定义好HTML的基本属性，我们可以在改该原型新增属性和方法，添加特性。

``` javascript
var proto = Object.create(HTMLElement.prototype);
proto.hello = 'hello';
proto.sayHello = function () {
    alert(this.hello);
};
var MyTag = document.registerElement('my-tag', {
    prototype: proto
});
```

### 扩展原生元素特性
`document.registerElement()` 的第二个参数还允许我们为扩展原生素的特性。

扩展原生元素的特性，并不是都是使用`HTMLElement.prototype`，而是使用该元素的原型对象去扩展特性。比如，扩展`button`元素
``` javascript
var MyButton = document.registerElement('my-button', {
    extend: 'button',
    prototpye: Object.create(HTMLButtonElement.prototype)
});
```
这类自定义元素被称为类型扩展自定义元素。
``` html
<button is="my-button"><button>
```
从表现来看，这类自定义元素，表示继承自某个特性的元素原型，表达了 元素`button`是扩展元素`my-button`。

### 生命周期以及回调方法

在我们创建自定义元素，到使用自定义元素，到从文档中删除自定义元素，都有对应的生命周期以及回调方法。

1. createdCallback(): 元素创建后回调。
2. attachCallback(): 元素附加到文档后调用。
3. detachCallback(): 元素从文档移除后调用。
4. attributeChangedCallback(): 元素任意属性变化后调用。

``` html
<my-tag></my-tag>
```
``` javascript
var myTagProto = Object.create(HTMLElement.prototype);

myTagProto.createdCallback = function() {
    // 元素创建后回调。
    this.textContent = '我被创建了';
};

var MyTag = document.registerElement('my-tag', {
    prototype: myTagProto
});
```

### 通过`customElements` 创建自定义元素

`document.registerElement()` 并不是创建自定义元素的唯一方式，使用`customElements`，也可以创建自定义元素。
``` javascript
class MyTag extends HTMLElement {
    constructor() {
        super();
        this._name = '';
    }
    static get observedAttributed() {
        return ['name'];
    }
    get name() {
        reutrn this._name;
    }
    set name(value) {
        this.setAttribute('name', value);
    }
    _update() {
        this.textContent = this._name;
    }
    attributeChangedCallback(name, oldValue, newValue) {
        this._name = newValue;
        this._update();
    }
}
customElements.define("my-tag", MyTag);
```
